{"ast":null,"code":"var _jsxFileName = \"E:\\\\RailBite-main\\\\railbite-frontend\\\\src\\\\context\\\\NotificationContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/context/NotificationContext.js\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { notificationsAPI } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NotificationContext = /*#__PURE__*/createContext();\nexport const useNotification = () => {\n  _s();\n  const context = useContext(NotificationContext);\n  if (!context) {\n    throw new Error('useNotification must be used within NotificationProvider');\n  }\n  return context;\n};\n_s(useNotification, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const NotificationProvider = ({\n  children\n}) => {\n  _s2();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const loadNotifications = async filter => {\n    try {\n      setLoading(true);\n      setError(null);\n      const res = await notificationsAPI.listMy(filter);\n      if (res.data.success) {\n        setNotifications(res.data.data || []);\n        // backend already returns unreadCount, but recompute for safety\n        const unread = (res.data.data || []).filter(n => !n.read).length;\n        setUnreadCount(unread);\n      } else {\n        setNotifications([]);\n        setUnreadCount(0);\n      }\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('loadNotifications error:', err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Failed to load notifications');\n      setNotifications([]);\n      setUnreadCount(0);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const refreshUnreadCount = async () => {\n    try {\n      const res = await notificationsAPI.unreadCount();\n      if (res.data.success) {\n        setUnreadCount(res.data.count || 0);\n      }\n    } catch (err) {\n      console.error('refreshUnreadCount error:', err);\n      // keep existing unreadCount on error\n    }\n  };\n  const markAllAsRead = async () => {\n    try {\n      await notificationsAPI.markAllRead();\n      setNotifications(prev => prev.map(n => ({\n        ...n,\n        read: true\n      })));\n      setUnreadCount(0);\n    } catch (err) {\n      console.error('markAllAsRead error:', err);\n    }\n  };\n  const markNotificationRead = async id => {\n    try {\n      const res = await notificationsAPI.markOneRead(id);\n      if (res.data.success) {\n        setNotifications(prev => prev.map(n => n._id === id ? {\n          ...n,\n          read: true\n        } : n));\n        setUnreadCount(prev => Math.max(prev - 1, 0));\n      }\n    } catch (err) {\n      console.error('markNotificationRead error:', err);\n    }\n  };\n  const deleteNotification = async id => {\n    try {\n      await notificationsAPI.deleteOne(id);\n      setNotifications(prev => prev.filter(n => n._id !== id));\n      // recompute unread\n      setUnreadCount(prev => Math.max(notifications.filter(n => !n.read && n._id !== id).length, 0));\n    } catch (err) {\n      console.error('deleteNotification error:', err);\n    }\n  };\n  const clearAllNotifications = async () => {\n    try {\n      await notificationsAPI.clearAll();\n      setNotifications([]);\n      setUnreadCount(0);\n    } catch (err) {\n      console.error('clearAllNotifications error:', err);\n    }\n  };\n\n  // For now, \"addNotification\" is an in-memory helper for UI; real\n  // backend creation is driven from orderController / server side.\n  const addNotificationLocal = notification => {\n    const newNotification = {\n      _id: Date.now().toString(),\n      read: false,\n      createdAt: new Date().toISOString(),\n      ...notification\n    };\n    setNotifications(prev => [newNotification, ...prev]);\n    setUnreadCount(prev => prev + 1);\n  };\n\n  // Initial load\n  useEffect(() => {\n    loadNotifications('unread'); // or 'all'\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const value = {\n    notifications,\n    unreadCount,\n    loading,\n    error,\n    loadNotifications,\n    refreshUnreadCount,\n    markAllAsRead,\n    markNotificationRead,\n    deleteNotification,\n    clearAllNotifications,\n    addNotificationLocal\n  };\n  return /*#__PURE__*/_jsxDEV(NotificationContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 152,\n    columnNumber: 5\n  }, this);\n};\n_s2(NotificationProvider, \"e+nRsg1S6dTN7G32JeEL+XgFhnc=\");\n_c = NotificationProvider;\nvar _c;\n$RefreshReg$(_c, \"NotificationProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","notificationsAPI","jsxDEV","_jsxDEV","NotificationContext","useNotification","_s","context","Error","NotificationProvider","children","_s2","notifications","setNotifications","unreadCount","setUnreadCount","loading","setLoading","error","setError","loadNotifications","filter","res","listMy","data","success","unread","n","read","length","err","_err$response","_err$response$data","console","response","message","refreshUnreadCount","count","markAllAsRead","markAllRead","prev","map","markNotificationRead","id","markOneRead","_id","Math","max","deleteNotification","deleteOne","clearAllNotifications","clearAll","addNotificationLocal","notification","newNotification","Date","now","toString","createdAt","toISOString","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/RailBite-main/railbite-frontend/src/context/NotificationContext.js"],"sourcesContent":["// src/context/NotificationContext.js\r\nimport React, {\r\n  createContext,\r\n  useContext,\r\n  useState,\r\n  useEffect,\r\n} from 'react';\r\nimport { notificationsAPI } from '../services/api';\r\n\r\nconst NotificationContext = createContext();\r\n\r\nexport const useNotification = () => {\r\n  const context = useContext(NotificationContext);\r\n  if (!context) {\r\n    throw new Error(\r\n      'useNotification must be used within NotificationProvider'\r\n    );\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const NotificationProvider = ({ children }) => {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const loadNotifications = async (filter) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const res = await notificationsAPI.listMy(filter);\r\n      if (res.data.success) {\r\n        setNotifications(res.data.data || []);\r\n        // backend already returns unreadCount, but recompute for safety\r\n        const unread = (res.data.data || []).filter((n) => !n.read).length;\r\n        setUnreadCount(unread);\r\n      } else {\r\n        setNotifications([]);\r\n        setUnreadCount(0);\r\n      }\r\n    } catch (err) {\r\n      console.error('loadNotifications error:', err);\r\n      setError(\r\n        err.response?.data?.message || 'Failed to load notifications'\r\n      );\r\n      setNotifications([]);\r\n      setUnreadCount(0);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const refreshUnreadCount = async () => {\r\n    try {\r\n      const res = await notificationsAPI.unreadCount();\r\n      if (res.data.success) {\r\n        setUnreadCount(res.data.count || 0);\r\n      }\r\n    } catch (err) {\r\n      console.error('refreshUnreadCount error:', err);\r\n      // keep existing unreadCount on error\r\n    }\r\n  };\r\n\r\n  const markAllAsRead = async () => {\r\n    try {\r\n      await notificationsAPI.markAllRead();\r\n      setNotifications((prev) =>\r\n        prev.map((n) => ({ ...n, read: true }))\r\n      );\r\n      setUnreadCount(0);\r\n    } catch (err) {\r\n      console.error('markAllAsRead error:', err);\r\n    }\r\n  };\r\n\r\n  const markNotificationRead = async (id) => {\r\n    try {\r\n      const res = await notificationsAPI.markOneRead(id);\r\n      if (res.data.success) {\r\n        setNotifications((prev) =>\r\n          prev.map((n) => (n._id === id ? { ...n, read: true } : n))\r\n        );\r\n        setUnreadCount((prev) => Math.max(prev - 1, 0));\r\n      }\r\n    } catch (err) {\r\n      console.error('markNotificationRead error:', err);\r\n    }\r\n  };\r\n\r\n  const deleteNotification = async (id) => {\r\n    try {\r\n      await notificationsAPI.deleteOne(id);\r\n      setNotifications((prev) => prev.filter((n) => n._id !== id));\r\n      // recompute unread\r\n      setUnreadCount((prev) =>\r\n        Math.max(\r\n          (notifications.filter((n) => !n.read && n._id !== id).length),\r\n          0\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error('deleteNotification error:', err);\r\n    }\r\n  };\r\n\r\n  const clearAllNotifications = async () => {\r\n    try {\r\n      await notificationsAPI.clearAll();\r\n      setNotifications([]);\r\n      setUnreadCount(0);\r\n    } catch (err) {\r\n      console.error('clearAllNotifications error:', err);\r\n    }\r\n  };\r\n\r\n  // For now, \"addNotification\" is an in-memory helper for UI; real\r\n  // backend creation is driven from orderController / server side.\r\n  const addNotificationLocal = (notification) => {\r\n    const newNotification = {\r\n      _id: Date.now().toString(),\r\n      read: false,\r\n      createdAt: new Date().toISOString(),\r\n      ...notification,\r\n    };\r\n    setNotifications((prev) => [newNotification, ...prev]);\r\n    setUnreadCount((prev) => prev + 1);\r\n  };\r\n\r\n  // Initial load\r\n  useEffect(() => {\r\n    loadNotifications('unread'); // or 'all'\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const value = {\r\n    notifications,\r\n    unreadCount,\r\n    loading,\r\n    error,\r\n    loadNotifications,\r\n    refreshUnreadCount,\r\n    markAllAsRead,\r\n    markNotificationRead,\r\n    deleteNotification,\r\n    clearAllNotifications,\r\n    addNotificationLocal,\r\n  };\r\n\r\n  return (\r\n    <NotificationContext.Provider value={value}>\r\n      {children}\r\n    </NotificationContext.Provider>\r\n  );\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}